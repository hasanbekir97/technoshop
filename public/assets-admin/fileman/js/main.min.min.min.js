$.ajaxSetup({cache:false});function selectFile(b){$("#pnlFileList li").removeClass("selected");$(b).prop("class","selected");var a=RoxyUtils.GetFilename($(b).attr("data-path"));a+=" ("+t("Size")+": "+RoxyUtils.FormatFileSize($(b).attr("data-size"));if($(b).attr("data-w")>0){a+=", "+t("Dimensions")+":"+$(b).attr("data-w")+"x"+$(b).attr("data-h")}a+=")";$("#pnlStatus").html(a)}function getLastDir(){return RoxyUtils.GetCookie("roxyld")}function setLastDir(a){RoxyUtils.SetCookie("roxyld",a,10)}function selectDir(a){var b=Directory.Parse($(a).parent("li").attr("data-path"));if(b){b.Select()}}function startDragDir(){}function startDragFile(){selectFile(this)}function dragFileOver(){$(this).children("img.dir").attr("src","images/folder-green.png")}function dragFileOut(){$("#pnlDirList").find("img.dir").attr("src","images/folder.png")}function makeDragFile(b){var a=new File($(b.target).closest("li").attr("data-path"));return'<div class="pnlDragFile" data-path="'+a.fullPath+'"><img src="'+a.bigIcon+'" align="absmiddle">&nbsp;'+a.name+"</div>"}function makeDragDir(b){var a=new Directory($(b.target).attr("data-path")?$(b.target).attr("data-path"):$(b.target).closest("li").attr("data-path"));return'<div class="pnlDragDir" data-path="'+a.fullPath+'"><img src="images/folder.png" align="absmiddle">&nbsp;'+a.name+"</div>"}function moveDir(c,f,b){var d=Directory.Parse(f.draggable.attr("data-path"));var a=Directory.Parse($(b).parent("li").attr("data-path"));if(a.fullPath!=d.path){d.Move(a.fullPath)}}function moveFile(b,j,a){var h=new File(j.draggable.attr("data-path"));var g=Directory.Parse($(a).parent("li").attr("data-path"));var c=Directory.Parse(h.path);if(h.path!=g.fullPath){h.Move(g.fullPath)}}function moveObject(b,a){b.stopPropagation();if(a.draggable.hasClass("directory")){moveDir(b,a,this)}else{moveFile(b,a,this)}dragFileOut()}function clickFirstOnEnter(a){$("#"+a).unbind("keypress");$(".actions input").each(function(){this.blur()});$("#"+a).keypress(function(b){if(b.keyCode==$.ui.keyCode.ENTER){b.stopPropagation();$(this).parent().find(".ui-dialog-buttonset button").eq(0).trigger("click")}})}function addDir(){var b=getSelectedDir();if(!b){return}clickFirstOnEnter("pnlDirName");$("#txtDirName").val("");var a={};a[t("CreateDir")]=function(){var c=$.trim($("#txtDirName").val());if(!c){alert(t("E_MissingDirName"))}if(b.Create(c)){$("#pnlDirName").dialog("close")}};a[t("Cancel")]=function(){$("#pnlDirName").dialog("close")};$("#pnlDirName").dialog({title:t("T_CreateDir"),modal:true,buttons:a})}var uploadFileList=new Array();function showUploadList(b){var a=$("#uploadFilesList");a.html("");clearFileField();for(i=0;i<b.length;i++){a.append('<div class="fileUpload"><div class="fileName">'+b[i].name+" ("+RoxyUtils.FormatFileSize(b[i].size)+')<span class="progressPercent"></span><div class="uploadProgress"><div class="stripes"></div></div></div><a class="removeUpload" onclick="removeUpload('+i+')"></a></div>')}if(b.length>0){$("#btnUpload").button("enable")}else{$("#btnUpload").button("disable")}}function listUploadFiles(a){if(!window.FileList){$("#btnUpload").button("enable")}else{if(a.length>0){uploadFileList=new Array();addUploadFiles(a)}}}function addUploadFiles(a){for(i=0;i<a.length;i++){uploadFileList.push(a[i])}showUploadList(uploadFileList)}function removeUpload(c){var a=findUploadElement(c);a.remove();try{uploadFileList.splice(c,1);showUploadList(uploadFileList)}catch(b){}}function findUploadElement(a){return $("#uploadFilesList .fileUpload:eq("+(a)+")")}function updateUploadProgress(b,c){var d=findUploadElement(c);var a=99;if(b.lengthComputable){a=Math.floor((b.loaded/b.total)*100)}if(a>99){a=99}d.find(".uploadProgress").css("width",a+"%");d.find(".progressPercent").html(" - "+a+"%")}function uploadComplete(b,a){uploadFinished(b,a,"ok")}function uploadError(b,a){setUploadError(a);uploadFinished(b,a,"error")}function setUploadError(a){var b=findUploadElement(a);b.find(".uploadProgress").css("width","100%").addClass("uploadError").removeClass("uploadComplete");b.find(".progressPercent").html(' - <span class="error">'+t("E_UploadingFile")+"</span>")}function setUploadSuccess(a){var b=findUploadElement(a);b.find(".uploadProgress").css("width","100%").removeClass("uploadError").addClass("uploadComplete");b.find(".progressPercent").html(" - 100%")}function uploadCanceled(b,a){uploadFinished(b,a,"error")}function uploadFinished(d,b,a){var c=findUploadElement(b);var f=null;try{f=JSON.parse(d.target.responseText)}catch(g){}if((f&&f.res=="error")||a!="ok"){a="error";setUploadError(b)}else{a="ok";setUploadSuccess(b)}c.attr("data-ulpoad",a);checkUploadResult()}function checkUploadResult(){var e=$("#uploadFilesList .fileUpload").length;var c=$("#uploadFilesList .fileUpload[data-ulpoad]").length;var b=$('#uploadFilesList .fileUpload[data-ulpoad="ok"]').length;if(c==e){uploadFileList=new Array();var a=Directory.Parse($("#hdDir").val());a.ListFiles(true);$("#btnUpload").button("disable")}}function fileUpload(c,a){var e=new XMLHttpRequest();var d=new FormData();var b=findUploadElement(a);b.find(".removeUpload").remove();d.append("action","upload");d.append("method","ajax");d.append("d",$("#hdDir").attr("value"));d.append("files[]",c);e.upload.addEventListener("progress",function(f){updateUploadProgress(f,a)},false);e.addEventListener("load",function(f){uploadComplete(f,a)},false);e.addEventListener("error",function(f){uploadError(f,a)},false);e.addEventListener("abort",function(f){uploadCanceled(f,a)},false);e.open("POST",RoxyFilemanConf.UPLOAD,true);e.setRequestHeader("Accept","*/*");e.send(d)}function dropFiles(b,a){if(b&&b.dataTransfer&&b.dataTransfer.files){addFile();if(a){addUploadFiles(b.dataTransfer.files)}else{listUploadFiles(b.dataTransfer.files)}}else{addFile()}}function clearFileField(a){if(!a){a="#fileUploads"}try{$(a).val("");$(a).val(null)}catch(b){}}function addFileClick(){$("#uploadResult").html("");showUploadList(new Array());addFile()}function addFile(){clickFirstOnEnter("dlgAddFile");$("#uploadResult").html("");clearFileField();var a={};a[t("Upload")]={id:"btnUpload",text:t("Upload"),disabled:true,click:function(){if(!$("#fileUploads").val()&&(!uploadFileList||uploadFileList.length==0)){alert(t("E_SelectFiles"))}else{if(!RoxyFilemanConf.UPLOAD){alert(t("E_ActionDisabled"))}else{if(window.FormData&&window.XMLHttpRequest&&window.FileList&&uploadFileList&&uploadFileList.length>0){for(i=0;i<uploadFileList.length;i++){fileUpload(uploadFileList[i],i)}}else{document.forms.addfile.action=RoxyFilemanConf.UPLOAD;document.forms.addfile.submit()}}}}};a[t("Cancel")]=function(){$("#dlgAddFile").dialog("close")};$("#dlgAddFile").dialog({title:t("T_AddFile"),modal:true,buttons:a,width:400})}function fileUploaded(a){if(a.res=="ok"&&a.msg){$("#dlgAddFile").dialog("close");var b=Directory.Parse($("#hdDir").val());b.ListFiles(true);alert(a.msg)}else{if(a.res=="ok"){$("#dlgAddFile").dialog("close");var b=Directory.Parse($("#hdDir").val());b.ListFiles(true)}else{alert(a.msg)}}}function renameDir(){var b=getSelectedDir();if(!b){return}if($('[data-path="'+b.fullPath+'"]').parents("li").length<1){alert(t("E_CannotRenameRoot"));return}clickFirstOnEnter("pnlDirName");$("#txtDirName").val(b.name);var a={};a[t("RenameDir")]=function(){var c=$.trim($("#txtDirName").val());if(!c){alert(t("E_MissingDirName"))}if(b.Rename(c)){$("#pnlDirName").dialog("close")}};a[t("Cancel")]=function(){$("#pnlDirName").dialog("close")};$("#pnlDirName").dialog({title:t("T_RenameDir"),modal:true,buttons:a});RoxyUtils.SelectText("txtDirName",0,new String(b.name).length)}function renameFile(){var b=getSelectedFile();if(!b){return}clickFirstOnEnter("pnlRenameFile");$("#txtFileName").val(b.name);var a={};a[t("RenameFile")]=function(){var c=$.trim($("#txtFileName").val());if(!c){alert("Missing file name")}else{if(b.Rename(c)){$('li[data-path="'+b.fullPath+'"] .name').text(c);$('li[data-path="'+b.fullPath+'"]').attr("data-path",RoxyUtils.MakePath(b.path,c));$("#pnlRenameFile").dialog("close")}}};a[t("Cancel")]=function(){$("#pnlRenameFile").dialog("close")};$("#pnlRenameFile").dialog({title:t("T_RenameFile"),modal:true,buttons:a});if(b.name.lastIndexOf(".")>0){RoxyUtils.SelectText("txtFileName",0,b.name.lastIndexOf("."))}}function getSelectedFile(){var a=null;if($("#pnlFileList .selected").length>0){a=new File($("#pnlFileList .selected").attr("data-path"))}return a}function getSelectedDir(){var a=null;if($("#pnlDirList .selected")){a=Directory.Parse($("#pnlDirList .selected").closest("li").attr("data-path"))}return a}function deleteDir(a){var b=null;if(a){b=Directory.Parse(a)}else{b=getSelectedDir()}if(b&&confirm(t("Q_DeleteFolder"))){b.Delete()}}function deleteFile(){var a=getSelectedFile();if(a&&confirm(t("Q_DeleteFile"))){a.Delete()}}function previewFile(){var a=getSelectedFile();if(a){window.open(a.fullPath)}}function downloadFile(){var b=getSelectedFile();if(b&&RoxyFilemanConf.DOWNLOAD){var a=RoxyUtils.AddParam(RoxyFilemanConf.DOWNLOAD,"f",b.fullPath);window.frames.frmUploadFile.location.href=a}else{if(!RoxyFilemanConf.DOWNLOAD){alert(t("E_ActionDisabled"))}}}function downloadDir(){var b=getSelectedDir();if(b&&RoxyFilemanConf.DOWNLOADDIR){var a=RoxyUtils.AddParam(RoxyFilemanConf.DOWNLOADDIR,"d",b.fullPath);window.frames.frmUploadFile.location.href=a}else{if(!RoxyFilemanConf.DOWNLOAD){alert(t("E_ActionDisabled"))}}}function closeMenus(a){if(!a||a=="dir"){$("#menuDir").fadeOut()}if(!a||a=="file"){$("#menuFile").fadeOut()}}function selectFirst(){var a=$("#pnlDirList li:first").children("div").first();if(a.length>0){selectDir(a)}else{window.setTimeout("selectFirst()",300)}}function tooltipContent(){if($("#menuFile").is(":visible")){return""}var a="";var b=File.Parse($(this).attr("data-path"));if($("#hdViewType").val()=="thumb"&&b.IsImage()){a=b.fullPath+'<br><span class="filesize">'+t("Size")+": "+RoxyUtils.FormatFileSize(b.size)+" "+t("Dimensions")+": "+b.width+"x"+b.height+"</span>"}else{if(b.IsImage()){if(RoxyFilemanConf.GENERATETHUMB){imgUrl=RoxyUtils.AddParam(RoxyFilemanConf.GENERATETHUMB,"f",b.fullPath);imgUrl=RoxyUtils.AddParam(imgUrl,"width",RoxyFilemanConf.PREVIEW_THUMB_WIDTH);imgUrl=RoxyUtils.AddParam(imgUrl,"height",RoxyFilemanConf.PREVIEW_THUMB_HEIGHT)}else{imgUrl=b.fullPath}a='<img src="'+imgUrl+'" class="imgPreview"><br>'+b.name+' <br><span class="filesize">'+t("Size")+": "+RoxyUtils.FormatFileSize(b.size)+" "+t("Dimensions")+": "+b.width+"x"+b.height+"</span>"}else{a=b.fullPath+' <span class="filesize">'+t("Size")+": "+RoxyUtils.FormatFileSize(b.size)+"</span>"}}return a}function filterFiles(){var b=$("#txtSearch").val();$("#pnlSearchNoFiles").hide();if($("#pnlFileList li").length==0){return}if(!b){$("#pnlFileList li").show();return}var a=0;$("#pnlFileList li").each(function(){var c=$(this).children(".name").text();if(c.toLowerCase().indexOf(b.toLowerCase())>-1){a++;$(this).show()}else{$(this).removeClass("selected");$(this).hide()}});if(a==0){$("#pnlSearchNoFiles").show()}}function sortFiles(){var a=getSelectedDir();if(!a){return}a.ListFiles();filterFiles();switchView($("#hdViewType").val())}function switchView(a){if(a==$("#hdViewType").val()){return}if(!a){a=$("#hdViewType").val()}$(".btnView").removeClass("selected");if(a=="thumb"){$("#pnlFileList .icon").attr("src","images/blank.gif");$("#pnlFileList").addClass("thumbView");if($("#dynStyle").length==0){$("head").append('<style id="dynStyle" />');var b="ul#pnlFileList.thumbView li{width:"+RoxyFilemanConf.THUMBS_VIEW_WIDTH+"px;}";b+="ul#pnlFileList.thumbView li{height:"+(parseInt(RoxyFilemanConf.THUMBS_VIEW_HEIGHT)+20)+"px;}";b+="ul#pnlFileList.thumbView .icon{width:"+RoxyFilemanConf.THUMBS_VIEW_WIDTH+"px;}";b+="ul#pnlFileList.thumbView .icon{height:"+RoxyFilemanConf.THUMBS_VIEW_HEIGHT+"px;}";$("#dynStyle").html(b)}$("#pnlFileList li").each(function(){var c=$(this).attr("data-icon-big");if(RoxyFilemanConf.GENERATETHUMB&&RoxyUtils.IsImage($(this).attr("data-path"))){c=RoxyUtils.AddParam(RoxyFilemanConf.GENERATETHUMB,"f",c);c=RoxyUtils.AddParam(c,"width",RoxyFilemanConf.THUMBS_VIEW_WIDTH);c=RoxyUtils.AddParam(c,"height",RoxyFilemanConf.THUMBS_VIEW_HEIGHT)}$(this).children(".icon").css("background-image","url("+c+")");$(this).tooltip("option","show",{delay:50})});$("#btnThumbView").addClass("selected")}else{$("#pnlFileList").removeClass("thumbView");$("#pnlFileList li").each(function(){$(this).children(".icon").css("background-image","").attr("src",$(this).attr("data-icon"));$(this).tooltip("option","show",{delay:500})});$("#btnListView").addClass("selected")}$("#hdViewType").val(a);RoxyUtils.SetCookie("roxyview",a,10)}var clipBoard=null;function Clipboard(b,c){this.action=b;this.obj=c}function cutDir(){var a=getSelectedDir();if(a){setClipboard("cut",a);a.GetElement().addClass("pale")}}function copyDir(){var a=getSelectedDir();if(a){setClipboard("copy",a)}}function cutFile(){var a=getSelectedFile();if(a){setClipboard("cut",a);a.GetElement().addClass("pale")}}function copyFile(){var a=getSelectedFile();if(a){setClipboard("copy",a)}}function pasteToFiles(c,b){if($(b).hasClass("pale")){c.stopPropagation();return false}var a=getSelectedDir();if(!a){a=Directory.Parse($("#pnlDirList li:first").children("div").first())}if(a&&clipBoard&&clipBoard.obj){if(clipBoard.action=="copy"){clipBoard.obj.Copy(a.fullPath)}else{clipBoard.obj.Move(a.fullPath);clearClipboard()}}return true}function pasteToDirs(c,b){if($(b).hasClass("pale")){c.stopPropagation();return false}var a=getSelectedDir();if(!a){a=Directory.Parse($("#pnlDirList li:first").children("div").first())}if(clipBoard&&a){if(clipBoard.action=="copy"){clipBoard.obj.Copy(a.fullPath)}else{clipBoard.obj.Move(a.fullPath);clearClipboard();a.ListFiles(true)}}else{alert("error")}return true}function clearClipboard(){$("#pnlDirList li").removeClass("pale");$("#pnlFileList li").removeClass("pale");clipBoard=null;$(".paste").addClass("pale")}function setClipboard(b,c){clearClipboard();if(c){clipBoard=new Clipboard(b,c);$(".paste").removeClass("pale")}}function ResizeLists(){var a=$(window).innerHeight()-$("#fileActions .actions").outerHeight()-$(".bottomLine").outerHeight();$(".scrollPane").css("height",a)}function removeDisabledActions(){if(RoxyFilemanConf.CREATEDIR==""){$("#mnuCreateDir").next().remove();$("#mnuCreateDir").remove();$("#btnAddDir").remove()}if(RoxyFilemanConf.DELETEDIR==""){$("#mnuDeleteDir").prev().remove();$("#mnuDeleteDir").remove();$("#btnDeleteDir").remove()}if(RoxyFilemanConf.MOVEDIR==""){$("#mnuDirCut").next().remove();$("#mnuDirCut").remove()}if(RoxyFilemanConf.COPYDIR==""){$("#mnuDirCopy").next().remove();$("#mnuDirCopy").remove()}if(RoxyFilemanConf.COPYDIR==""&&RoxyFilemanConf.MOVEDIR==""){$("#mnuDirPaste").next().remove();$("#mnuDirPaste").remove()}if(RoxyFilemanConf.RENAMEDIR==""){$("#mnuRenameDir").next().remove();$("#mnuRenameDir").remove();$("#btnRenameDir").remove()}if(RoxyFilemanConf.UPLOAD==""){$("#btnAddFile").remove()}if(RoxyFilemanConf.DOWNLOAD==""){$("#mnuDownload").next().remove();$("#mnuDownload").remove()}if(RoxyFilemanConf.DOWNLOADDIR==""){$("#mnuDownloadDir").next().remove();$("#mnuDownloadDir").remove()}if(RoxyFilemanConf.DELETEFILE==""){$("#mnuDeleteFile").prev().remove();$("#mnuDeleteFile").remove();$("#btnDeleteFile").remove()}if(RoxyFilemanConf.MOVEFILE==""){$("#mnuFileCut").next().remove();$("#mnuFileCut").remove()}if(RoxyFilemanConf.COPYFILE==""){$("#mnuFileCopy").next().remove();$("#mnuFileCopy").remove()}if(RoxyFilemanConf.COPYFILE==""&&RoxyFilemanConf.MOVEFILE==""){$("#mnuFilePaste").next().remove();$("#mnuFilePaste").remove()}if(RoxyFilemanConf.RENAMEFILE==""){$("#mnuRenameFile").next().remove();$("#mnuRenameFile").remove();$("#btnRenameFile").remove()}}function getPreselectedFile(){var a=RoxyUtils.GetUrlParam("selected");if(!a){switch(getFilemanIntegration()){case"ckeditor":try{var e=window.opener.CKEDITOR.dialog.getCurrent();a=e.getValueOf("info",(e.getName()=="link"?"url":"txtUrl"))}catch(d){}break;case"tinymce3":try{var c=tinyMCEPopup.getWindowArg("window");a=c.document.getElementById(tinyMCEPopup.getWindowArg("input")).value;if(a.indexOf("..")==0){a=a.substr(2)}}catch(d){}break;case"tinymce4":try{var c=(window.opener?window.opener:window.parent);a=c.document.getElementById(RoxyUtils.GetUrlParam("input")).value;if(a.indexOf("..")==0){a=a.substr(2)}}catch(d){}break;default:a=GetSelectedValue();break}}if(RoxyFilemanConf.RETURN_URL_PREFIX){var b=RoxyFilemanConf.RETURN_URL_PREFIX;if(a.indexOf(b)==0){if(b.substr(-1)=="/"){b=b.substr(0,b.length-1)}a=a.substr(b.length)}}return a}function initSelection(a){var f=false,e=true;if(!a){a=getPreselectedFile()}if(!a&&RoxyUtils.ToBool(RoxyFilemanConf.OPEN_LAST_DIR)){a=getLastDir();e=false}if(a){var b=(e?RoxyUtils.GetPath(a):a);var c=tmp=Directory.Parse(b);do{if(tmp){tmp.Expand(true);f=true}tmp=Directory.Parse(tmp.path)}while(tmp);if(c){c.Select(a);f=true}}if(!f){selectFirst()}}$(function(){RoxyUtils.LoadConfig();var b=new Directory();b.LoadAll();$("#wraper").show();window.setTimeout("initSelection()",100);RoxyUtils.Translate();$("body").click(function(){closeMenus()});var c=RoxyUtils.GetCookie("roxyview");if(!c){c=RoxyFilemanConf.DEFAULTVIEW}if(c){switchView(c)}ResizeLists();$(".actions input").tooltip({track:true});$(window).resize(ResizeLists);document.oncontextmenu=function(){return false};removeDisabledActions();$("#copyYear").html(new Date().getFullYear());if(RoxyFilemanConf.UPLOAD&&RoxyFilemanConf.UPLOAD!=""){var a=document.getElementById("fileActions");a.ondragover=function(){return false};a.ondragend=function(){return false};a.ondrop=function(d){d.preventDefault();d.stopPropagation();dropFiles(d)};a=document.getElementById("dlgAddFile");a.ondragover=function(){return false};a.ondragend=function(){return false};a.ondrop=function(d){d.preventDefault();d.stopPropagation();dropFiles(d,true)}}if(getFilemanIntegration()=="tinymce3"){try{$("body").append('<script src="js/tiny_mce_popup.js"><\/script>')}catch(e){}}});function getFilemanIntegration(){var a=RoxyUtils.GetUrlParam("integration");if(!a){a=RoxyFilemanConf.INTEGRATION}return a.toLowerCase()}function setFile(){var a=getSelectedFile();if(!a){alert(t("E_NoFileSelected"));return}var c=a.fullPath;if(RoxyFilemanConf.RETURN_URL_PREFIX){var d=RoxyFilemanConf.RETURN_URL_PREFIX;if(d.substr(-1)=="/"){d=d.substr(0,d.length-1)}c=d+(c.substr(0,1)!="/"?"/":"")+c}switch(getFilemanIntegration()){case"ckeditor":window.opener.CKEDITOR.tools.callFunction(RoxyUtils.GetUrlParam("CKEditorFuncNum"),c);self.close();break;case"tinymce3":var b=tinyMCEPopup.getWindowArg("window");b.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=c;if(typeof(b.ImageDialog)!="undefined"){if(b.ImageDialog.getImageData){b.ImageDialog.getImageData()}if(b.ImageDialog.showPreviewImage){b.ImageDialog.showPreviewImage(c)}}tinyMCEPopup.close();break;case"tinymce4":var b=(window.opener?window.opener:window.parent);b.document.getElementById(RoxyUtils.GetUrlParam("input")).value=c;if(typeof(b.ImageDialog)!="undefined"){if(b.ImageDialog.getImageData){b.ImageDialog.getImageData()}if(b.ImageDialog.showPreviewImage){b.ImageDialog.showPreviewImage(c)}}b.tinyMCE.activeEditor.windowManager.close();break;default:FileSelected(a);break}};