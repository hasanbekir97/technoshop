function Directory(e,f,d){if(!e){e=""}this.fullPath=e;this.name=RoxyUtils.GetFilename(e);if(!this.name){this.name="My files"}this.path=RoxyUtils.GetPath(e);this.dirs=(f?f:0);this.files=(d?d:0);this.filesList=new Array();this.Show=function(){var b=this.GetHtml();var a=null;a=$('li[data-path="'+this.path+'"]');if(a.length==0){a=$("#pnlDirList")}else{if(a.children("ul").length==0){a.append("<ul></ul>")}a=a.children("ul")}if(a){a.append(b);this.SetEvents()}};this.SetEvents=function(){var a=this.GetElement();if(RoxyFilemanConf.MOVEDIR){a.draggable({helper:makeDragDir,start:startDragDir,cursorAt:{left:10,top:10},delay:200})}a=a.children("div");a.click(function(b){selectDir(this)});a.bind("contextmenu",function(b){b.stopPropagation();b.preventDefault();closeMenus("file");selectDir(this);var c=b.pageY-$("#menuDir").height();if(c<0){c=0}$("#menuDir").css({top:c+"px",left:b.pageX+"px"}).show();return false});a.droppable({drop:moveObject,over:dragFileOver,out:dragFileOut});a=a.children(".dirPlus");a.click(function(c){c.stopPropagation();var b=Directory.Parse($(this).closest("li").attr("data-path"));b.Expand()})};this.GetHtml=function(){var a='<li data-path="'+this.fullPath+'" data-dirs="'+this.dirs+'" data-files="'+this.files+'" class="directory">';a+='<div><img src="images/'+(this.dirs>0?"dir-plus.png":"blank.gif")+'" class="dirPlus" width="9" height="9">';a+='<img src="images/folder.png" class="dir"><span class="name">'+this.name+" ("+this.files+")</span></div>";a+="</li>";return a};this.SetStatusBar=function(){$("#pnlStatus").html(this.files+" "+(this.files==1?t("file"):t("files")))};this.SetSelectedFile=function(a){if(a){var b=File.Parse(a);if(b){selectFile(b.GetElement())}}};this.Select=function(b){var c=this.GetElement();c.children("div").addClass("selected");$('#pnlDirList li[data-path!="'+this.fullPath+'"] > div').removeClass("selected");c.children("img.dir").prop("src","images/folder.png");this.SetStatusBar();var a=this.GetParent();while(a){a.Expand(true);a=a.GetParent()}this.Expand(true);this.ListFiles(true,b);setLastDir(this.fullPath)};this.GetElement=function(){return $('li[data-path="'+this.fullPath+'"]')};this.IsExpanded=function(){var a=this.GetElement().children("ul");return(a&&a.is(":visible"))};this.IsListed=function(){if($("#hdDir").val()==this.fullPath){return true}return false};this.GetExpanded=function(a){var b=new Array();if(!a){a=$("#pnlDirList")}a.children("li").each(function(){var h=$(this).attr("data-path");var c=new Directory(h);if(c){if(c.IsExpanded()&&h){b.push(h)}b=b.concat(c.GetExpanded(c.GetElement().children("ul")))}});return b};this.RestoreExpanded=function(b){for(i=0;i<b.length;i++){var a=Directory.Parse(b[i]);if(a){a.Expand(true)}}};this.GetParent=function(){return Directory.Parse(this.path)};this.SetOpened=function(){var a=this.GetElement();if(a.find("li").length<1){a.children("div").children(".dirPlus").prop("src","images/blank.gif")}else{if(this.IsExpanded()){a.children("div").children(".dirPlus").prop("src","images/dir-minus.png")}else{a.children("div").children(".dirPlus").prop("src","images/dir-plus.png")}}};this.Update=function(a){var b=this.GetElement();if(a){this.fullPath=a;this.name=RoxyUtils.GetFilename(a);if(!this.name){this.name="My files"}this.path=RoxyUtils.GetPath(a)}b.attr("data-path",this.fullPath);b.attr("data-dirs",this.dirs);b.attr("data-files",this.files);b.children("div").children(".name").html(this.name+" ("+this.files+")");this.SetOpened()};this.LoadAll=function(h){var b=this.GetExpanded();var c=RoxyFilemanConf.DIRLIST;if(!c){alert(t("E_ActionDisabled"));return}$("#pnlLoadingDirs").show();$("#pnlDirList").hide();c=RoxyUtils.AddParam(c,"type",RoxyUtils.GetUrlParam("type"));var a=this;$.ajax({url:c,type:"POST",dataType:"json",async:false,cache:false,success:function(k){$("#pnlDirList").children("li").remove();for(i=0;i<k.length;i++){var g=new Directory(k[i].p,k[i].d,k[i].f);g.Show()}$("#pnlLoadingDirs").hide();$("#pnlDirList").show();a.RestoreExpanded(b);var g=Directory.Parse(h);if(g){g.Select()}},error:function(g){$("#pnlLoadingDirs").hide();$("#pnlDirList").show();alert(t("E_LoadingAjax")+" "+RoxyFilemanConf.DIRLIST)}})};this.Expand=function(b){var c=this.GetElement();var a=c.children("ul");if(this.IsExpanded()&&!b){a.hide()}else{a.show()}this.SetOpened()};this.Create=function(h){if(!h){return false}else{if(!RoxyFilemanConf.CREATEDIR){alert(t("E_ActionDisabled"));return}}var b=RoxyUtils.AddParam(RoxyFilemanConf.CREATEDIR,"d",this.fullPath);b=RoxyUtils.AddParam(b,"n",h);var a=this;var c=false;$.ajax({url:b,type:"POST",data:{d:this.fullPath,n:h},dataType:"json",async:false,cache:false,success:function(g){if(g.res.toLowerCase()=="ok"){a.LoadAll(RoxyUtils.MakePath(a.fullPath,h));c=true}else{alert(g.msg)}},error:function(g){alert(t("E_LoadingAjax")+" "+a.name)}});return c};this.Delete=function(){if(!RoxyFilemanConf.DELETEDIR){alert(t("E_ActionDisabled"));return}var b=RoxyUtils.AddParam(RoxyFilemanConf.DELETEDIR,"d",this.fullPath);var a=this;var c=false;$.ajax({url:b,type:"POST",data:{d:this.fullPath},dataType:"json",async:false,cache:false,success:function(j){if(j.res.toLowerCase()=="ok"){var k=a.GetParent();k.dirs--;k.Update();k.Select();a.GetElement().remove();c=true}if(j.msg){alert(j.msg)}},error:function(h){alert(t("E_LoadingAjax")+" "+a.name)}});return c};this.Rename=function(h){if(!h){return false}else{if(!RoxyFilemanConf.RENAMEDIR){alert(t("E_ActionDisabled"));return}}var b=RoxyUtils.AddParam(RoxyFilemanConf.RENAMEDIR,"d",this.fullPath);b=RoxyUtils.AddParam(b,"n",h);var a=this;var c=false;$.ajax({url:b,type:"POST",data:{d:this.fullPath,n:h},dataType:"json",async:false,cache:false,success:function(g){if(g.res.toLowerCase()=="ok"){var k=RoxyUtils.MakePath(a.path,h);a.Update(k);a.Select();c=true}if(g.msg){alert(g.msg)}},error:function(g){alert(t("E_LoadingAjax")+" "+a.name)}});return c};this.Copy=function(a){if(!RoxyFilemanConf.COPYDIR){alert(t("E_ActionDisabled"));return}var c=RoxyUtils.AddParam(RoxyFilemanConf.COPYDIR,"d",this.fullPath);c=RoxyUtils.AddParam(c,"n",a);var b=this;var h=false;$.ajax({url:c,type:"POST",data:{d:this.fullPath,n:a},dataType:"json",async:false,cache:false,success:function(k){if(k.res.toLowerCase()=="ok"){var g=Directory.Parse(a);if(g){g.LoadAll(g.fullPath)}h=true}if(k.msg){alert(k.msg)}},error:function(g){alert(t("E_LoadingAjax")+" "+c)}});return h};this.Move=function(a){if(!a){return false}else{if(!RoxyFilemanConf.MOVEDIR){alert(t("E_ActionDisabled"));return}}var c=RoxyUtils.AddParam(RoxyFilemanConf.MOVEDIR,"d",this.fullPath);c=RoxyUtils.AddParam(c,"n",a);var b=this;var h=false;$.ajax({url:c,type:"POST",data:{d:this.fullPath,n:a},dataType:"json",async:false,cache:false,success:function(g){if(g.res.toLowerCase()=="ok"){b.LoadAll(RoxyUtils.MakePath(a,b.name));h=true}if(g.msg){alert(g.msg)}},error:function(g){alert(t("E_LoadingAjax")+" "+b.name)}});return h};this.ListFiles=function(a,b){$("#pnlLoading").show();$("#pnlEmptyDir").hide();$("#pnlFileList").hide();$("#pnlSearchNoFiles").hide();this.LoadFiles(a,b)};this.FilesLoaded=function(a,c){a=this.SortFiles(a);$("#pnlFileList").html("");for(i=0;i<a.length;i++){var b=a[i];b.Show()}$("#hdDir").val(this.fullPath);$("#pnlLoading").hide();if($("#pnlFileList").children("li").length==0){$("#pnlEmptyDir").show()}this.files=$("#pnlFileList").children("li").length;this.Update();this.SetStatusBar();filterFiles();switchView();$("#pnlFileList").show();this.SetSelectedFile(c)};this.LoadFiles=function(b,c){if(!RoxyFilemanConf.FILESLIST){alert(t("E_ActionDisabled"));return}var j=new Array();var k=RoxyFilemanConf.FILESLIST;k=RoxyUtils.AddParam(k,"d",this.fullPath);k=RoxyUtils.AddParam(k,"type",RoxyUtils.GetUrlParam("type"));var a=this;if(!this.IsListed()||b){$.ajax({url:k,type:"POST",data:{d:this.fullPath,type:RoxyUtils.GetUrlParam("type")},dataType:"json",async:true,cache:false,success:function(g){for(i=0;i<g.length;i++){j.push(new File(g[i].p,g[i].s,g[i].t,g[i].w,g[i].h))}a.FilesLoaded(j,c)},error:function(g){alert(t("E_LoadingAjax")+" "+k)}})}else{$("#pnlFileList li").each(function(){j.push(new File($(this).attr("data-path"),$(this).attr("data-size"),$(this).attr("data-time"),$(this).attr("data-w"),$(this).attr("data-h")))});a.FilesLoaded(j,c)}return j};this.SortByName=function(a,b){a.sort(function(c,j){var k=(b=="desc"?0:2);c=c.name.toLowerCase();j=j.name.toLowerCase();if(c>j){return -1+k}else{if(c<j){return 1-k}else{return 0}}});return a};this.SortBySize=function(a,b){a.sort(function(c,j){var k=(b=="desc"?0:2);c=parseInt(c.size);j=parseInt(j.size);if(c>j){return -1+k}else{if(c<j){return 1-k}else{return 0}}});return a};this.SortByTime=function(a,b){a.sort(function(c,j){var k=(b=="desc"?0:2);c=parseInt(c.time);j=parseInt(j.time);if(c>j){return -1+k}else{if(c<j){return 1-k}else{return 0}}});return a};this.SortFiles=function(a){var b=$("#ddlOrder").val();if(!b){b="name"}switch(b){case"size":a=this.SortBySize(a,"asc");break;case"size_desc":a=this.SortBySize(a,"desc");break;case"time":a=this.SortByTime(a,"asc");break;case"time_desc":a=this.SortByTime(a,"desc");break;case"name_desc":a=this.SortByName(a,"desc");break;default:a=this.SortByName(a,"asc")}return a}}Directory.Parse=function(f){var d=false;var e=$("#pnlDirList").find('li[data-path="'+f+'"]');if(e.length>0){d=new Directory(e.attr("data-path"),e.attr("data-dirs"),e.attr("data-files"))}return d};