function Directory(a,c,b){if(!a){a=""}this.fullPath=a;this.name=RoxyUtils.GetFilename(a);if(!this.name){this.name="My files"}this.path=RoxyUtils.GetPath(a);this.dirs=(c?c:0);this.files=(b?b:0);this.filesList=new Array();this.Show=function(){var d=this.GetHtml();var e=null;e=$('li[data-path="'+this.path+'"]');if(e.length==0){e=$("#pnlDirList")}else{if(e.children("ul").length==0){e.append("<ul></ul>")}e=e.children("ul")}if(e){e.append(d);this.SetEvents()}};this.SetEvents=function(){var d=this.GetElement();if(RoxyFilemanConf.MOVEDIR){d.draggable({helper:makeDragDir,start:startDragDir,cursorAt:{left:10,top:10},delay:200})}d=d.children("div");d.click(function(f){selectDir(this)});d.bind("contextmenu",function(g){g.stopPropagation();g.preventDefault();closeMenus("file");selectDir(this);var f=g.pageY-$("#menuDir").height();if(f<0){f=0}$("#menuDir").css({top:f+"px",left:g.pageX+"px"}).show();return false});d.droppable({drop:moveObject,over:dragFileOver,out:dragFileOut});d=d.children(".dirPlus");d.click(function(f){f.stopPropagation();var g=Directory.Parse($(this).closest("li").attr("data-path"));g.Expand()})};this.GetHtml=function(){var d='<li data-path="'+this.fullPath+'" data-dirs="'+this.dirs+'" data-files="'+this.files+'" class="directory">';d+='<div><img src="images/'+(this.dirs>0?"dir-plus.png":"blank.gif")+'" class="dirPlus" width="9" height="9">';d+='<img src="images/folder.png" class="dir"><span class="name">'+this.name+" ("+this.files+")</span></div>";d+="</li>";return d};this.SetStatusBar=function(){$("#pnlStatus").html(this.files+" "+(this.files==1?t("file"):t("files")))};this.SetSelectedFile=function(e){if(e){var d=File.Parse(e);if(d){selectFile(d.GetElement())}}};this.Select=function(e){var d=this.GetElement();d.children("div").addClass("selected");$('#pnlDirList li[data-path!="'+this.fullPath+'"] > div').removeClass("selected");d.children("img.dir").prop("src","images/folder.png");this.SetStatusBar();var f=this.GetParent();while(f){f.Expand(true);f=f.GetParent()}this.Expand(true);this.ListFiles(true,e);setLastDir(this.fullPath)};this.GetElement=function(){return $('li[data-path="'+this.fullPath+'"]')};this.IsExpanded=function(){var d=this.GetElement().children("ul");return(d&&d.is(":visible"))};this.IsListed=function(){if($("#hdDir").val()==this.fullPath){return true}return false};this.GetExpanded=function(e){var d=new Array();if(!e){e=$("#pnlDirList")}e.children("li").each(function(){var f=$(this).attr("data-path");var g=new Directory(f);if(g){if(g.IsExpanded()&&f){d.push(f)}d=d.concat(g.GetExpanded(g.GetElement().children("ul")))}});return d};this.RestoreExpanded=function(e){for(i=0;i<e.length;i++){var f=Directory.Parse(e[i]);if(f){f.Expand(true)}}};this.GetParent=function(){return Directory.Parse(this.path)};this.SetOpened=function(){var d=this.GetElement();if(d.find("li").length<1){d.children("div").children(".dirPlus").prop("src","images/blank.gif")}else{if(this.IsExpanded()){d.children("div").children(".dirPlus").prop("src","images/dir-minus.png")}else{d.children("div").children(".dirPlus").prop("src","images/dir-plus.png")}}};this.Update=function(e){var d=this.GetElement();if(e){this.fullPath=e;this.name=RoxyUtils.GetFilename(e);if(!this.name){this.name="My files"}this.path=RoxyUtils.GetPath(e)}d.attr("data-path",this.fullPath);d.attr("data-dirs",this.dirs);d.attr("data-files",this.files);d.children("div").children(".name").html(this.name+" ("+this.files+")");this.SetOpened()};this.LoadAll=function(d){var f=this.GetExpanded();var e=RoxyFilemanConf.DIRLIST;if(!e){alert(t("E_ActionDisabled"));return}$("#pnlLoadingDirs").show();$("#pnlDirList").hide();e=RoxyUtils.AddParam(e,"type",RoxyUtils.GetUrlParam("type"));var g=this;$.ajax({url:e,type:"POST",dataType:"json",async:false,cache:false,success:function(h){$("#pnlDirList").children("li").remove();for(i=0;i<h.length;i++){var j=new Directory(h[i].p,h[i].d,h[i].f);j.Show()}$("#pnlLoadingDirs").hide();$("#pnlDirList").show();g.RestoreExpanded(f);var j=Directory.Parse(d);if(j){j.Select()}},error:function(h){$("#pnlLoadingDirs").hide();$("#pnlDirList").show();alert(t("E_LoadingAjax")+" "+RoxyFilemanConf.DIRLIST)}})};this.Expand=function(e){var d=this.GetElement();var f=d.children("ul");if(this.IsExpanded()&&!e){f.hide()}else{f.show()}this.SetOpened()};this.Create=function(d){if(!d){return false}else{if(!RoxyFilemanConf.CREATEDIR){alert(t("E_ActionDisabled"));return}}var f=RoxyUtils.AddParam(RoxyFilemanConf.CREATEDIR,"d",this.fullPath);f=RoxyUtils.AddParam(f,"n",d);var g=this;var e=false;$.ajax({url:f,type:"POST",data:{d:this.fullPath,n:d},dataType:"json",async:false,cache:false,success:function(h){if(h.res.toLowerCase()=="ok"){g.LoadAll(RoxyUtils.MakePath(g.fullPath,d));e=true}else{alert(h.msg)}},error:function(h){alert(t("E_LoadingAjax")+" "+g.name)}});return e};this.Delete=function(){if(!RoxyFilemanConf.DELETEDIR){alert(t("E_ActionDisabled"));return}var e=RoxyUtils.AddParam(RoxyFilemanConf.DELETEDIR,"d",this.fullPath);var f=this;var d=false;$.ajax({url:e,type:"POST",data:{d:this.fullPath},dataType:"json",async:false,cache:false,success:function(h){if(h.res.toLowerCase()=="ok"){var g=f.GetParent();g.dirs--;g.Update();g.Select();f.GetElement().remove();d=true}if(h.msg){alert(h.msg)}},error:function(g){alert(t("E_LoadingAjax")+" "+f.name)}});return d};this.Rename=function(d){if(!d){return false}else{if(!RoxyFilemanConf.RENAMEDIR){alert(t("E_ActionDisabled"));return}}var f=RoxyUtils.AddParam(RoxyFilemanConf.RENAMEDIR,"d",this.fullPath);f=RoxyUtils.AddParam(f,"n",d);var g=this;var e=false;$.ajax({url:f,type:"POST",data:{d:this.fullPath,n:d},dataType:"json",async:false,cache:false,success:function(j){if(j.res.toLowerCase()=="ok"){var h=RoxyUtils.MakePath(g.path,d);g.Update(h);g.Select();e=true}if(j.msg){alert(j.msg)}},error:function(h){alert(t("E_LoadingAjax")+" "+g.name)}});return e};this.Copy=function(g){if(!RoxyFilemanConf.COPYDIR){alert(t("E_ActionDisabled"));return}var e=RoxyUtils.AddParam(RoxyFilemanConf.COPYDIR,"d",this.fullPath);e=RoxyUtils.AddParam(e,"n",g);var f=this;var d=false;$.ajax({url:e,type:"POST",data:{d:this.fullPath,n:g},dataType:"json",async:false,cache:false,success:function(h){if(h.res.toLowerCase()=="ok"){var j=Directory.Parse(g);if(j){j.LoadAll(j.fullPath)}d=true}if(h.msg){alert(h.msg)}},error:function(h){alert(t("E_LoadingAjax")+" "+e)}});return d};this.Move=function(g){if(!g){return false}else{if(!RoxyFilemanConf.MOVEDIR){alert(t("E_ActionDisabled"));return}}var e=RoxyUtils.AddParam(RoxyFilemanConf.MOVEDIR,"d",this.fullPath);e=RoxyUtils.AddParam(e,"n",g);var f=this;var d=false;$.ajax({url:e,type:"POST",data:{d:this.fullPath,n:g},dataType:"json",async:false,cache:false,success:function(h){if(h.res.toLowerCase()=="ok"){f.LoadAll(RoxyUtils.MakePath(g,f.name));d=true}if(h.msg){alert(h.msg)}},error:function(h){alert(t("E_LoadingAjax")+" "+f.name)}});return d};this.ListFiles=function(e,d){$("#pnlLoading").show();$("#pnlEmptyDir").hide();$("#pnlFileList").hide();$("#pnlSearchNoFiles").hide();this.LoadFiles(e,d)};this.FilesLoaded=function(g,d){g=this.SortFiles(g);$("#pnlFileList").html("");for(i=0;i<g.length;i++){var e=g[i];e.Show()}$("#hdDir").val(this.fullPath);$("#pnlLoading").hide();if($("#pnlFileList").children("li").length==0){$("#pnlEmptyDir").show()}this.files=$("#pnlFileList").children("li").length;this.Update();this.SetStatusBar();filterFiles();switchView();$("#pnlFileList").show();this.SetSelectedFile(d)};this.LoadFiles=function(g,f){if(!RoxyFilemanConf.FILESLIST){alert(t("E_ActionDisabled"));return}var e=new Array();var d=RoxyFilemanConf.FILESLIST;d=RoxyUtils.AddParam(d,"d",this.fullPath);d=RoxyUtils.AddParam(d,"type",RoxyUtils.GetUrlParam("type"));var h=this;if(!this.IsListed()||g){$.ajax({url:d,type:"POST",data:{d:this.fullPath,type:RoxyUtils.GetUrlParam("type")},dataType:"json",async:true,cache:false,success:function(j){for(i=0;i<j.length;i++){e.push(new File(j[i].p,j[i].s,j[i].t,j[i].w,j[i].h))}h.FilesLoaded(e,f)},error:function(j){alert(t("E_LoadingAjax")+" "+d)}})}else{$("#pnlFileList li").each(function(){e.push(new File($(this).attr("data-path"),$(this).attr("data-size"),$(this).attr("data-time"),$(this).attr("data-w"),$(this).attr("data-h")))});h.FilesLoaded(e,f)}return e};this.SortByName=function(e,d){e.sort(function(h,g){var f=(d=="desc"?0:2);h=h.name.toLowerCase();g=g.name.toLowerCase();if(h>g){return -1+f}else{if(h<g){return 1-f}else{return 0}}});return e};this.SortBySize=function(e,d){e.sort(function(h,g){var f=(d=="desc"?0:2);h=parseInt(h.size);g=parseInt(g.size);if(h>g){return -1+f}else{if(h<g){return 1-f}else{return 0}}});return e};this.SortByTime=function(e,d){e.sort(function(h,g){var f=(d=="desc"?0:2);h=parseInt(h.time);g=parseInt(g.time);if(h>g){return -1+f}else{if(h<g){return 1-f}else{return 0}}});return e};this.SortFiles=function(e){var d=$("#ddlOrder").val();if(!d){d="name"}switch(d){case"size":e=this.SortBySize(e,"asc");break;case"size_desc":e=this.SortBySize(e,"desc");break;case"time":e=this.SortByTime(e,"asc");break;case"time_desc":e=this.SortByTime(e,"desc");break;case"name_desc":e=this.SortByName(e,"desc");break;default:e=this.SortByName(e,"asc")}return e}}Directory.Parse=function(c){var b=false;var a=$("#pnlDirList").find('li[data-path="'+c+'"]');if(a.length>0){b=new Directory(a.attr("data-path"),a.attr("data-dirs"),a.attr("data-files"))}return b};