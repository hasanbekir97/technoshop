$.ajaxSetup({cache:false});function selectFile(c){$("#pnlFileList li").removeClass("selected");$(c).prop("class","selected");var d=RoxyUtils.GetFilename($(c).attr("data-path"));d+=" ("+t("Size")+": "+RoxyUtils.FormatFileSize($(c).attr("data-size"));if($(c).attr("data-w")>0){d+=", "+t("Dimensions")+":"+$(c).attr("data-w")+"x"+$(c).attr("data-h")}d+=")";$("#pnlStatus").html(d)}function getLastDir(){return RoxyUtils.GetCookie("roxyld")}function setLastDir(b){RoxyUtils.SetCookie("roxyld",b,10)}function selectDir(d){var c=Directory.Parse($(d).parent("li").attr("data-path"));if(c){c.Select()}}function startDragDir(){}function startDragFile(){selectFile(this)}function dragFileOver(){$(this).children("img.dir").attr("src","images/folder-green.png")}function dragFileOut(){$("#pnlDirList").find("img.dir").attr("src","images/folder.png")}function makeDragFile(c){var d=new File($(c.target).closest("li").attr("data-path"));return'<div class="pnlDragFile" data-path="'+d.fullPath+'"><img src="'+d.bigIcon+'" align="absmiddle">&nbsp;'+d.name+"</div>"}function makeDragDir(c){var d=new Directory($(c.target).attr("data-path")?$(c.target).attr("data-path"):$(c.target).closest("li").attr("data-path"));return'<div class="pnlDragDir" data-path="'+d.fullPath+'"><img src="images/folder.png" align="absmiddle">&nbsp;'+d.name+"</div>"}function moveDir(h,e,j){var g=Directory.Parse(e.draggable.attr("data-path"));var k=Directory.Parse($(j).parent("li").attr("data-path"));if(k.fullPath!=g.path){g.Move(k.fullPath)}}function moveFile(l,d,m){var e=new File(d.draggable.attr("data-path"));var f=Directory.Parse($(m).parent("li").attr("data-path"));var k=Directory.Parse(e.path);if(e.path!=f.fullPath){e.Move(f.fullPath)}}function moveObject(c,d){c.stopPropagation();if(d.draggable.hasClass("directory")){moveDir(c,d,this)}else{moveFile(c,d,this)}dragFileOut()}function clickFirstOnEnter(b){$("#"+b).unbind("keypress");$(".actions input").each(function(){this.blur()});$("#"+b).keypress(function(a){if(a.keyCode==$.ui.keyCode.ENTER){a.stopPropagation();$(this).parent().find(".ui-dialog-buttonset button").eq(0).trigger("click")}})}function addDir(){var c=getSelectedDir();if(!c){return}clickFirstOnEnter("pnlDirName");$("#txtDirName").val("");var d={};d[t("CreateDir")]=function(){var a=$.trim($("#txtDirName").val());if(!a){alert(t("E_MissingDirName"))}if(c.Create(a)){$("#pnlDirName").dialog("close")}};d[t("Cancel")]=function(){$("#pnlDirName").dialog("close")};$("#pnlDirName").dialog({title:t("T_CreateDir"),modal:true,buttons:d})}var uploadFileList=new Array();function showUploadList(c){var d=$("#uploadFilesList");d.html("");clearFileField();for(i=0;i<c.length;i++){d.append('<div class="fileUpload"><div class="fileName">'+c[i].name+" ("+RoxyUtils.FormatFileSize(c[i].size)+')<span class="progressPercent"></span><div class="uploadProgress"><div class="stripes"></div></div></div><a class="removeUpload" onclick="removeUpload('+i+')"></a></div>')}if(c.length>0){$("#btnUpload").button("enable")}else{$("#btnUpload").button("disable")}}function listUploadFiles(b){if(!window.FileList){$("#btnUpload").button("enable")}else{if(b.length>0){uploadFileList=new Array();addUploadFiles(b)}}}function addUploadFiles(b){for(i=0;i<b.length;i++){uploadFileList.push(b[i])}showUploadList(uploadFileList)}function removeUpload(d){var f=findUploadElement(d);f.remove();try{uploadFileList.splice(d,1);showUploadList(uploadFileList)}catch(e){}}function findUploadElement(b){return $("#uploadFilesList .fileUpload:eq("+(b)+")")}function updateUploadProgress(g,f){var e=findUploadElement(f);var h=99;if(g.lengthComputable){h=Math.floor((g.loaded/g.total)*100)}if(h>99){h=99}e.find(".uploadProgress").css("width",h+"%");e.find(".progressPercent").html(" - "+h+"%")}function uploadComplete(c,d){uploadFinished(c,d,"ok")}function uploadError(c,d){setUploadError(d);uploadFinished(c,d,"error")}function setUploadError(d){var c=findUploadElement(d);c.find(".uploadProgress").css("width","100%").addClass("uploadError").removeClass("uploadComplete");c.find(".progressPercent").html(' - <span class="error">'+t("E_UploadingFile")+"</span>")}function setUploadSuccess(d){var c=findUploadElement(d);c.find(".uploadProgress").css("width","100%").removeClass("uploadError").addClass("uploadComplete");c.find(".progressPercent").html(" - 100%")}function uploadCanceled(c,d){uploadFinished(c,d,"error")}function uploadFinished(j,l,m){var k=findUploadElement(l);var h=null;try{h=JSON.parse(j.target.responseText)}catch(e){}if((h&&h.res=="error")||m!="ok"){m="error";setUploadError(l)}else{m="ok";setUploadSuccess(l)}k.attr("data-ulpoad",m);checkUploadResult()}function checkUploadResult(){var d=$("#uploadFilesList .fileUpload").length;var f=$("#uploadFilesList .fileUpload[data-ulpoad]").length;var g=$('#uploadFilesList .fileUpload[data-ulpoad="ok"]').length;if(f==d){uploadFileList=new Array();var h=Directory.Parse($("#hdDir").val());h.ListFiles(true);$("#btnUpload").button("disable")}}function fileUpload(h,k){var f=new XMLHttpRequest();var g=new FormData();var j=findUploadElement(k);j.find(".removeUpload").remove();g.append("action","upload");g.append("method","ajax");g.append("d",$("#hdDir").attr("value"));g.append("files[]",h);f.upload.addEventListener("progress",function(a){updateUploadProgress(a,k)},false);f.addEventListener("load",function(a){uploadComplete(a,k)},false);f.addEventListener("error",function(a){uploadError(a,k)},false);f.addEventListener("abort",function(a){uploadCanceled(a,k)},false);f.open("POST",RoxyFilemanConf.UPLOAD,true);f.setRequestHeader("Accept","*/*");f.send(g)}function dropFiles(c,d){if(c&&c.dataTransfer&&c.dataTransfer.files){addFile();if(d){addUploadFiles(c.dataTransfer.files)}else{listUploadFiles(c.dataTransfer.files)}}else{addFile()}}function clearFileField(d){if(!d){d="#fileUploads"}try{$(d).val("");$(d).val(null)}catch(c){}}function addFileClick(){$("#uploadResult").html("");showUploadList(new Array());addFile()}function addFile(){clickFirstOnEnter("dlgAddFile");$("#uploadResult").html("");clearFileField();var b={};b[t("Upload")]={id:"btnUpload",text:t("Upload"),disabled:true,click:function(){if(!$("#fileUploads").val()&&(!uploadFileList||uploadFileList.length==0)){alert(t("E_SelectFiles"))}else{if(!RoxyFilemanConf.UPLOAD){alert(t("E_ActionDisabled"))}else{if(window.FormData&&window.XMLHttpRequest&&window.FileList&&uploadFileList&&uploadFileList.length>0){for(i=0;i<uploadFileList.length;i++){fileUpload(uploadFileList[i],i)}}else{document.forms.addfile.action=RoxyFilemanConf.UPLOAD;document.forms.addfile.submit()}}}}};b[t("Cancel")]=function(){$("#dlgAddFile").dialog("close")};$("#dlgAddFile").dialog({title:t("T_AddFile"),modal:true,buttons:b,width:400})}function fileUploaded(d){if(d.res=="ok"&&d.msg){$("#dlgAddFile").dialog("close");var c=Directory.Parse($("#hdDir").val());c.ListFiles(true);alert(d.msg)}else{if(d.res=="ok"){$("#dlgAddFile").dialog("close");var c=Directory.Parse($("#hdDir").val());c.ListFiles(true)}else{alert(d.msg)}}}function renameDir(){var c=getSelectedDir();if(!c){return}if($('[data-path="'+c.fullPath+'"]').parents("li").length<1){alert(t("E_CannotRenameRoot"));return}clickFirstOnEnter("pnlDirName");$("#txtDirName").val(c.name);var d={};d[t("RenameDir")]=function(){var a=$.trim($("#txtDirName").val());if(!a){alert(t("E_MissingDirName"))}if(c.Rename(a)){$("#pnlDirName").dialog("close")}};d[t("Cancel")]=function(){$("#pnlDirName").dialog("close")};$("#pnlDirName").dialog({title:t("T_RenameDir"),modal:true,buttons:d});RoxyUtils.SelectText("txtDirName",0,new String(c.name).length)}function renameFile(){var c=getSelectedFile();if(!c){return}clickFirstOnEnter("pnlRenameFile");$("#txtFileName").val(c.name);var d={};d[t("RenameFile")]=function(){var a=$.trim($("#txtFileName").val());if(!a){alert("Missing file name")}else{if(c.Rename(a)){$('li[data-path="'+c.fullPath+'"] .name').text(a);$('li[data-path="'+c.fullPath+'"]').attr("data-path",RoxyUtils.MakePath(c.path,a));$("#pnlRenameFile").dialog("close")}}};d[t("Cancel")]=function(){$("#pnlRenameFile").dialog("close")};$("#pnlRenameFile").dialog({title:t("T_RenameFile"),modal:true,buttons:d});if(c.name.lastIndexOf(".")>0){RoxyUtils.SelectText("txtFileName",0,c.name.lastIndexOf("."))}}function getSelectedFile(){var b=null;if($("#pnlFileList .selected").length>0){b=new File($("#pnlFileList .selected").attr("data-path"))}return b}function getSelectedDir(){var b=null;if($("#pnlDirList .selected")){b=Directory.Parse($("#pnlDirList .selected").closest("li").attr("data-path"))}return b}function deleteDir(d){var c=null;if(d){c=Directory.Parse(d)}else{c=getSelectedDir()}if(c&&confirm(t("Q_DeleteFolder"))){c.Delete()}}function deleteFile(){var b=getSelectedFile();if(b&&confirm(t("Q_DeleteFile"))){b.Delete()}}function previewFile(){var b=getSelectedFile();if(b){window.open(b.fullPath)}}function downloadFile(){var c=getSelectedFile();if(c&&RoxyFilemanConf.DOWNLOAD){var d=RoxyUtils.AddParam(RoxyFilemanConf.DOWNLOAD,"f",c.fullPath);window.frames.frmUploadFile.location.href=d}else{if(!RoxyFilemanConf.DOWNLOAD){alert(t("E_ActionDisabled"))}}}function downloadDir(){var c=getSelectedDir();if(c&&RoxyFilemanConf.DOWNLOADDIR){var d=RoxyUtils.AddParam(RoxyFilemanConf.DOWNLOADDIR,"d",c.fullPath);window.frames.frmUploadFile.location.href=d}else{if(!RoxyFilemanConf.DOWNLOAD){alert(t("E_ActionDisabled"))}}}function closeMenus(b){if(!b||b=="dir"){$("#menuDir").fadeOut()}if(!b||b=="file"){$("#menuFile").fadeOut()}}function selectFirst(){var b=$("#pnlDirList li:first").children("div").first();if(b.length>0){selectDir(b)}else{window.setTimeout("selectFirst()",300)}}function tooltipContent(){if($("#menuFile").is(":visible")){return""}var d="";var c=File.Parse($(this).attr("data-path"));if($("#hdViewType").val()=="thumb"&&c.IsImage()){d=c.fullPath+'<br><span class="filesize">'+t("Size")+": "+RoxyUtils.FormatFileSize(c.size)+" "+t("Dimensions")+": "+c.width+"x"+c.height+"</span>"}else{if(c.IsImage()){if(RoxyFilemanConf.GENERATETHUMB){imgUrl=RoxyUtils.AddParam(RoxyFilemanConf.GENERATETHUMB,"f",c.fullPath);imgUrl=RoxyUtils.AddParam(imgUrl,"width",RoxyFilemanConf.PREVIEW_THUMB_WIDTH);imgUrl=RoxyUtils.AddParam(imgUrl,"height",RoxyFilemanConf.PREVIEW_THUMB_HEIGHT)}else{imgUrl=c.fullPath}d='<img src="'+imgUrl+'" class="imgPreview"><br>'+c.name+' <br><span class="filesize">'+t("Size")+": "+RoxyUtils.FormatFileSize(c.size)+" "+t("Dimensions")+": "+c.width+"x"+c.height+"</span>"}else{d=c.fullPath+' <span class="filesize">'+t("Size")+": "+RoxyUtils.FormatFileSize(c.size)+"</span>"}}return d}function filterFiles(){var c=$("#txtSearch").val();$("#pnlSearchNoFiles").hide();if($("#pnlFileList li").length==0){return}if(!c){$("#pnlFileList li").show();return}var d=0;$("#pnlFileList li").each(function(){var a=$(this).children(".name").text();if(a.toLowerCase().indexOf(c.toLowerCase())>-1){d++;$(this).show()}else{$(this).removeClass("selected");$(this).hide()}});if(d==0){$("#pnlSearchNoFiles").show()}}function sortFiles(){var b=getSelectedDir();if(!b){return}b.ListFiles();filterFiles();switchView($("#hdViewType").val())}function switchView(d){if(d==$("#hdViewType").val()){return}if(!d){d=$("#hdViewType").val()}$(".btnView").removeClass("selected");if(d=="thumb"){$("#pnlFileList .icon").attr("src","images/blank.gif");$("#pnlFileList").addClass("thumbView");if($("#dynStyle").length==0){$("head").append('<style id="dynStyle" />');var c="ul#pnlFileList.thumbView li{width:"+RoxyFilemanConf.THUMBS_VIEW_WIDTH+"px;}";c+="ul#pnlFileList.thumbView li{height:"+(parseInt(RoxyFilemanConf.THUMBS_VIEW_HEIGHT)+20)+"px;}";c+="ul#pnlFileList.thumbView .icon{width:"+RoxyFilemanConf.THUMBS_VIEW_WIDTH+"px;}";c+="ul#pnlFileList.thumbView .icon{height:"+RoxyFilemanConf.THUMBS_VIEW_HEIGHT+"px;}";$("#dynStyle").html(c)}$("#pnlFileList li").each(function(){var a=$(this).attr("data-icon-big");if(RoxyFilemanConf.GENERATETHUMB&&RoxyUtils.IsImage($(this).attr("data-path"))){a=RoxyUtils.AddParam(RoxyFilemanConf.GENERATETHUMB,"f",a);a=RoxyUtils.AddParam(a,"width",RoxyFilemanConf.THUMBS_VIEW_WIDTH);a=RoxyUtils.AddParam(a,"height",RoxyFilemanConf.THUMBS_VIEW_HEIGHT)}$(this).children(".icon").css("background-image","url("+a+")");$(this).tooltip("option","show",{delay:50})});$("#btnThumbView").addClass("selected")}else{$("#pnlFileList").removeClass("thumbView");$("#pnlFileList li").each(function(){$(this).children(".icon").css("background-image","").attr("src",$(this).attr("data-icon"));$(this).tooltip("option","show",{delay:500})});$("#btnListView").addClass("selected")}$("#hdViewType").val(d);RoxyUtils.SetCookie("roxyview",d,10)}var clipBoard=null;function Clipboard(a,d){this.action=a;this.obj=d}function cutDir(){var b=getSelectedDir();if(b){setClipboard("cut",b);b.GetElement().addClass("pale")}}function copyDir(){var b=getSelectedDir();if(b){setClipboard("copy",b)}}function cutFile(){var b=getSelectedFile();if(b){setClipboard("cut",b);b.GetElement().addClass("pale")}}function copyFile(){var b=getSelectedFile();if(b){setClipboard("copy",b)}}function pasteToFiles(d,e){if($(e).hasClass("pale")){d.stopPropagation();return false}var f=getSelectedDir();if(!f){f=Directory.Parse($("#pnlDirList li:first").children("div").first())}if(f&&clipBoard&&clipBoard.obj){if(clipBoard.action=="copy"){clipBoard.obj.Copy(f.fullPath)}else{clipBoard.obj.Move(f.fullPath);clearClipboard()}}return true}function pasteToDirs(d,e){if($(e).hasClass("pale")){d.stopPropagation();return false}var f=getSelectedDir();if(!f){f=Directory.Parse($("#pnlDirList li:first").children("div").first())}if(clipBoard&&f){if(clipBoard.action=="copy"){clipBoard.obj.Copy(f.fullPath)}else{clipBoard.obj.Move(f.fullPath);clearClipboard();f.ListFiles(true)}}else{alert("error")}return true}function clearClipboard(){$("#pnlDirList li").removeClass("pale");$("#pnlFileList li").removeClass("pale");clipBoard=null;$(".paste").addClass("pale")}function setClipboard(a,d){clearClipboard();if(d){clipBoard=new Clipboard(a,d);$(".paste").removeClass("pale")}}function ResizeLists(){var b=$(window).innerHeight()-$("#fileActions .actions").outerHeight()-$(".bottomLine").outerHeight();$(".scrollPane").css("height",b)}function removeDisabledActions(){if(RoxyFilemanConf.CREATEDIR==""){$("#mnuCreateDir").next().remove();$("#mnuCreateDir").remove();$("#btnAddDir").remove()}if(RoxyFilemanConf.DELETEDIR==""){$("#mnuDeleteDir").prev().remove();$("#mnuDeleteDir").remove();$("#btnDeleteDir").remove()}if(RoxyFilemanConf.MOVEDIR==""){$("#mnuDirCut").next().remove();$("#mnuDirCut").remove()}if(RoxyFilemanConf.COPYDIR==""){$("#mnuDirCopy").next().remove();$("#mnuDirCopy").remove()}if(RoxyFilemanConf.COPYDIR==""&&RoxyFilemanConf.MOVEDIR==""){$("#mnuDirPaste").next().remove();$("#mnuDirPaste").remove()}if(RoxyFilemanConf.RENAMEDIR==""){$("#mnuRenameDir").next().remove();$("#mnuRenameDir").remove();$("#btnRenameDir").remove()}if(RoxyFilemanConf.UPLOAD==""){$("#btnAddFile").remove()}if(RoxyFilemanConf.DOWNLOAD==""){$("#mnuDownload").next().remove();$("#mnuDownload").remove()}if(RoxyFilemanConf.DOWNLOADDIR==""){$("#mnuDownloadDir").next().remove();$("#mnuDownloadDir").remove()}if(RoxyFilemanConf.DELETEFILE==""){$("#mnuDeleteFile").prev().remove();$("#mnuDeleteFile").remove();$("#btnDeleteFile").remove()}if(RoxyFilemanConf.MOVEFILE==""){$("#mnuFileCut").next().remove();$("#mnuFileCut").remove()}if(RoxyFilemanConf.COPYFILE==""){$("#mnuFileCopy").next().remove();$("#mnuFileCopy").remove()}if(RoxyFilemanConf.COPYFILE==""&&RoxyFilemanConf.MOVEFILE==""){$("#mnuFilePaste").next().remove();$("#mnuFilePaste").remove()}if(RoxyFilemanConf.RENAMEFILE==""){$("#mnuRenameFile").next().remove();$("#mnuRenameFile").remove();$("#btnRenameFile").remove()}}function getPreselectedFile(){var k=RoxyUtils.GetUrlParam("selected");if(!k){switch(getFilemanIntegration()){case"ckeditor":try{var f=window.opener.CKEDITOR.dialog.getCurrent();k=f.getValueOf("info",(f.getName()=="link"?"url":"txtUrl"))}catch(g){}break;case"tinymce3":try{var h=tinyMCEPopup.getWindowArg("window");k=h.document.getElementById(tinyMCEPopup.getWindowArg("input")).value;if(k.indexOf("..")==0){k=k.substr(2)}}catch(g){}break;case"tinymce4":try{var h=(window.opener?window.opener:window.parent);k=h.document.getElementById(RoxyUtils.GetUrlParam("input")).value;if(k.indexOf("..")==0){k=k.substr(2)}}catch(g){}break;default:k=GetSelectedValue();break}}if(RoxyFilemanConf.RETURN_URL_PREFIX){var j=RoxyFilemanConf.RETURN_URL_PREFIX;if(k.indexOf(j)==0){if(j.substr(-1)=="/"){j=j.substr(0,j.length-1)}k=k.substr(j.length)}}return k}function initSelection(k){var d=false,g=true;if(!k){k=getPreselectedFile()}if(!k&&RoxyUtils.ToBool(RoxyFilemanConf.OPEN_LAST_DIR)){k=getLastDir();g=false}if(k){var j=(g?RoxyUtils.GetPath(k):k);var h=tmp=Directory.Parse(j);do{if(tmp){tmp.Expand(true);d=true}tmp=Directory.Parse(tmp.path)}while(tmp);if(h){h.Select(k);d=true}}if(!d){selectFirst()}}$(function(){RoxyUtils.LoadConfig();var g=new Directory();g.LoadAll();$("#wraper").show();window.setTimeout("initSelection()",100);RoxyUtils.Translate();$("body").click(function(){closeMenus()});var f=RoxyUtils.GetCookie("roxyview");if(!f){f=RoxyFilemanConf.DEFAULTVIEW}if(f){switchView(f)}ResizeLists();$(".actions input").tooltip({track:true});$(window).resize(ResizeLists);document.oncontextmenu=function(){return false};removeDisabledActions();$("#copyYear").html(new Date().getFullYear());if(RoxyFilemanConf.UPLOAD&&RoxyFilemanConf.UPLOAD!=""){var h=document.getElementById("fileActions");h.ondragover=function(){return false};h.ondragend=function(){return false};h.ondrop=function(a){a.preventDefault();a.stopPropagation();dropFiles(a)};h=document.getElementById("dlgAddFile");h.ondragover=function(){return false};h.ondragend=function(){return false};h.ondrop=function(a){a.preventDefault();a.stopPropagation();dropFiles(a,true)}}if(getFilemanIntegration()=="tinymce3"){try{$("body").append('<script src="js/tiny_mce_popup.js"><\/script>')}catch(d){}}});function getFilemanIntegration(){var b=RoxyUtils.GetUrlParam("integration");if(!b){b=RoxyFilemanConf.INTEGRATION}return b.toLowerCase()}function setFile(){var h=getSelectedFile();if(!h){alert(t("E_NoFileSelected"));return}var f=h.fullPath;if(RoxyFilemanConf.RETURN_URL_PREFIX){var e=RoxyFilemanConf.RETURN_URL_PREFIX;if(e.substr(-1)=="/"){e=e.substr(0,e.length-1)}f=e+(f.substr(0,1)!="/"?"/":"")+f}switch(getFilemanIntegration()){case"ckeditor":window.opener.CKEDITOR.tools.callFunction(RoxyUtils.GetUrlParam("CKEditorFuncNum"),f);self.close();break;case"tinymce3":var g=tinyMCEPopup.getWindowArg("window");g.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=f;if(typeof(g.ImageDialog)!="undefined"){if(g.ImageDialog.getImageData){g.ImageDialog.getImageData()}if(g.ImageDialog.showPreviewImage){g.ImageDialog.showPreviewImage(f)}}tinyMCEPopup.close();break;case"tinymce4":var g=(window.opener?window.opener:window.parent);g.document.getElementById(RoxyUtils.GetUrlParam("input")).value=f;if(typeof(g.ImageDialog)!="undefined"){if(g.ImageDialog.getImageData){g.ImageDialog.getImageData()}if(g.ImageDialog.showPreviewImage){g.ImageDialog.showPreviewImage(f)}}g.tinyMCE.activeEditor.windowManager.close();break;default:FileSelected(h);break}};